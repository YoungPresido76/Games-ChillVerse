<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Idle Verses - Chill Verse</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a1a;
      --surface: rgba(20,25,50,0.92);
      --neon-cyan: #06b6d4;
      --neon-purple: #8b5cf6;
      --text: #e2e8f0;
      --glow: 0 0 8px rgba(6,182,212,0.5);
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Rajdhani', sans-serif;
      font-size: 12px; /* base font very small */
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow: hidden;
    }

    canvas { position: fixed; inset: 0; z-index: -1; opacity: 0.6; }

    .screen { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 8px; }
    .screen.active { display: flex; }

    .title { 
      font-family: 'Orbitron', monospace;
      font-size: clamp(1.2rem, 5vw, 1.8rem); 
      background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
      margin-bottom: 8px;
      filter: drop-shadow(var(--glow));
    }

    form { 
      width: 100%; max-width: 280px;
      background: var(--surface);
      padding: 20px 16px;
      border-radius: 10px;
      border: 1px solid rgba(6,182,212,0.3);
    }
    label { display: block; margin: 12px 0 6px; font-size: 0.9rem; }
    input { 
      width: 100%; padding: 8px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(6,182,212,0.4);
      border-radius: 6px;
      color: white; font-size: 0.9rem;
    }
    button { 
      width: 100%; padding: 10px; margin-top: 16px;
      background: linear-gradient(90deg, var(--neon-cyan), #00f0ff);
      color: #000;
      font-weight: 700; font-size: 0.95rem;
      border: none; border-radius: 6px;
      cursor: pointer;
    }

    .loader { text-align: center; font-size: 0.95rem; }
    .spinner { width: 32px; height: 32px; border: 4px solid rgba(6,182,212,0.2); border-top-color: var(--neon-cyan); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 12px; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .header { text-align: center; margin-bottom: 8px; position: relative; }
    .player-name-top { 
      position: absolute; top: 8px; right: 12px; 
      font-size: 0.9rem; opacity: 0.85; 
    }

    .layout { 
      display: grid; 
      grid-template-columns: 160px 1fr 180px; /* very narrow sidebars */
      gap: 8px; 
      height: calc(100vh - 60px); 
      padding: 0 8px; 
    }
    @media (max-width: 700px) { .layout { grid-template-columns: 1fr; height: auto; } }

    .sidebar, .profile { 
      background: var(--surface); 
      border-radius: 10px; 
      padding: 10px; 
      border: 1px solid rgba(6,182,212,0.2); 
    }
    .sidebar button { 
      width: 100%; padding: 8px; margin: 3px 0; 
      background: rgba(255,255,255,0.08); 
      border: 1px solid rgba(6,182,212,0.3); 
      border-radius: 6px; 
      font-size: 0.85rem; 
    }

    .content { 
      background: var(--surface); 
      border-radius: 10px; 
      padding: 12px; 
      border: 1px solid rgba(6,182,212,0.2); 
      overflow-y: auto; 
      font-size: 0.9rem;
    }

    .verse-row { 
      display: grid; 
      grid-template-columns: 1fr 70px 90px 80px; 
      gap: 6px; 
      padding: 8px; 
      background: rgba(255,255,255,0.05); 
      border-radius: 6px; 
      margin-bottom: 6px; 
      align-items: center; 
      font-size: 0.85rem;
    }

    .btn-buy { 
      background: #4a4; color: white; 
      padding: 6px; font-size: 0.8rem; border-radius: 4px; 
    }
    .btn-prestige { 
      background: linear-gradient(90deg, #1e3a5f, #334155); 
      color: var(--neon-cyan); 
      border: 1px solid var(--neon-cyan); 
      margin-top: 12px; 
      padding: 8px; 
      font-size: 0.9rem; 
      width: 100%; 
    }

    .sticky-btn {
      position: fixed; bottom: 12px; right: 12px;
      width: 48px; height: 48px;
      background: linear-gradient(135deg, var(--neon-purple), var(--neon-cyan));
      color: #000;
      border: none; border-radius: 50%;
      font-size: 1.1rem; font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      cursor: pointer; z-index: 100;
      display: flex; align-items: center; justify-content: center;
    }

    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal-content { background: var(--surface); padding: 20px; border-radius: 10px; max-width: 320px; text-align: center; border: 1px solid var(--neon-cyan); font-size: 0.9rem; }

    @media (prefers-reduced-motion: reduce) { * { animation: none !important; transition: none !important; } }
  </style>
</head>
<body>

<canvas id="particles" aria-hidden="true"></canvas>

<!-- Login -->
<section id="login" class="screen active">
  <h1 class="title">Idle Verses</h1>
  <form id="login-form">
    <label for="player-name">Your Name</label>
    <input id="player-name" type="text" placeholder="e.g. Presido" required>

    <label for="player-phone">WhatsApp Number</label>
    <input id="player-phone" type="tel" placeholder="+2348012345678" required>

    <button type="submit">Start Playing</button>
  </form>
</section>

<!-- Loading -->
<section id="loading" class="screen">
  <div class="loader">
    <div class="spinner"></div>
    <p>Setting up player logs...</p>
    <p id="logged-as" hidden>Logged in as <strong></strong></p>
  </div>
</section>

<!-- Main -->
<section id="main" class="screen" hidden>
  <header class="header">
    <h1 class="title">Idle Verses</h1>
    <div class="player-name-top" id="player-name-top"></div>
    <div class="stats">
      You have <span id="chills">10.0</span> chills<br>
      You are getting <span id="chills-per-sec">0</span> chills per second.
    </div>
  </header>

  <div class="layout">
    <!-- Left Sidebar (only Verses now) -->
    <nav class="sidebar">
      <button class="active">Verses</button>
    </nav>

    <!-- Content -->
    <main class="content">
      <div id="verses-list"></div>

      <div class="prestige">
        <h3>Verse Boost</h3>
        <p id="boost-req">Requires: 30 of 6th Verse</p>
        <button id="boost-btn" class="btn-prestige" disabled>
          Reset all Verse to get ×<span id="boost-mult">1.06</span> multiplier to all verse
        </button>
      </div>
    </main>

    <!-- Right Profile -->
    <aside class="profile">
      <div class="avatar" id="avatar"></div>
      <h3 id="profile-name"></h3>
      <p id="profile-phone"></p>
      <button id="logout">Logout</button>
      <button id="reset">Reset</button>
    </aside>
  </div>

  <!-- Sticky Round Earn Button -->
  <button id="sticky-earn" class="sticky-btn" aria-label="Earn Diamonds">Earn</button>
</section>

<!-- Modals -->
<dialog id="offline-modal" class="modal">
  <div class="modal-content">
    <h3>While you were away...</h3>
    <p id="offline-gain"></p>
    <button onclick="this.closest('dialog').close()">Close</button>
  </div>
</dialog>

<dialog id="convert-modal" class="modal">
  <div class="modal-content">
    <h3>Conversion Complete!</h3>
    <p id="convert-msg"></p>
    <p>Screenshot & send to Vicbot</p>
    <button onclick="this.closest('dialog').close()">Close</button>
  </div>
</dialog>

<script>
// ──────────────────────────────────────────────
// Game State
// ──────────────────────────────────────────────
let game = {
  name: '', phone: '',
  chills: 10,
  verses: [
    { name: '1st Verse', amount: 0, mult: 1, baseCost: 10, costMult: 1 },
    { name: '2nd Verse', amount: 0, mult: 1, baseCost: 100, costMult: 1 },
    { name: '3rd Verse', amount: 0, mult: 1, baseCost: 1e4, costMult: 1 },
    { name: '4th Verse', amount: 0, mult: 1, baseCost: 1e6, costMult: 1 },
    { name: '5th Verse', amount: 0, mult: 1, baseCost: 1e9, costMult: 1 },
    { name: '6th Verse', amount: 0, mult: 1, baseCost: 1e12, costMult: 1 }
  ],
  boostCount: 0,
  boostMult: 1,
  lastUpdate: Date.now()
};

// ──────────────────────────────────────────────
// Save / Load
// ──────────────────────────────────────────────
function saveGame() {
  localStorage.setItem('idleVerses', JSON.stringify(game));
}

function loadGame() {
  const saved = localStorage.getItem('idleVerses');
  if (saved) {
    const data = JSON.parse(saved);
    Object.assign(game, data);
    game.lastUpdate = data.lastUpdate || Date.now();
  }
}

// ──────────────────────────────────────────────
// Offline Progress (50% efficiency, max 24h)
// ──────────────────────────────────────────────
function calculateOfflineGain() {
  const now = Date.now();
  const deltaMs = Math.min(now - game.lastUpdate, 24 * 60 * 60 * 1000);
  if (deltaMs < 60000) return 0;

  const deltaSec = deltaMs / 1000;
  let gain = 0;

  // Simulate production at 50% rate
  let amounts = game.verses.map(v => v.amount);
  for (let sec = 0; sec < deltaSec; sec += 1) {
    let prod = 0;
    for (let i = 5; i >= 0; i--) {
      const rate = amounts[i] * game.verses[i].mult * game.boostMult * 0.5;
      if (i === 0) prod += rate;
      else amounts[i-1] += rate;
    }
    gain += prod;
  }

  return gain;
}

// ──────────────────────────────────────────────
// Tick (online production)
// ──────────────────────────────────────────────
function tick() {
  let prod = 0;
  let amounts = game.verses.map(v => v.amount);

  for (let i = 5; i >= 0; i--) {
    const rate = amounts[i] * game.verses[i].mult * game.boostMult;
    if (i === 0) {
      prod += rate;
    } else {
      amounts[i-1] += rate;
    }
  }

  game.chills += prod;
  game.lastUpdate = Date.now();
  saveGame();
  updateDisplay();
}

// ──────────────────────────────────────────────
// Buy Verse
// ──────────────────────────────────────────────
function buyVerse(index) {
  const v = game.verses[index];
  const cost = v.baseCost * Math.pow(100, Math.floor(v.amount / 10));
  if (game.chills >= cost) {
    game.chills -= cost;
    v.amount++;
    if (v.amount % 10 === 0) v.mult *= 2;
    updateDisplay();
    saveGame();
  }
}

// ──────────────────────────────────────────────
// Verse Boost
// ──────────────────────────────────────────────
function verseBoost() {
  const req = 30 + game.boostCount * 30;
  if (game.verses[5].amount < req) return;

  game.boostMult *= 1.06 + game.boostCount * 0.02;
  game.boostCount++;

  // Reset all verses
  game.verses.forEach(v => {
    v.amount = 0;
    v.mult = 1;
  });

  updateDisplay();
  saveGame();
}

// ──────────────────────────────────────────────
// Render Verses
// ──────────────────────────────────────────────
function renderVerses() {
  const list = document.getElementById('verses-list');
  list.innerHTML = '';

  game.verses.forEach((v, i) => {
    const unlocked = i === 0 || game.verses[i-1].amount > 0;
    const cost = v.baseCost * Math.pow(100, Math.floor(v.amount / 10));
    const row = document.createElement('div');
    row.className = `verse-row ${unlocked ? '' : 'locked'}`;
    row.innerHTML = `
      <div>${v.name}</div>
      <div>x${v.mult.toFixed(2)}</div>
      <div>${v.amount}</div>
      <button class="btn-buy" \( {game.chills < cost || !unlocked ? 'disabled' : ''} data-index=" \){i}">
        Cost: ${cost}
      </button>
    `;
    list.appendChild(row);
  });

  // Boost button
  const boostBtn = document.getElementById('boost-btn');
  const req = 30 + game.boostCount * 30;
  document.getElementById('boost-req').textContent = `Requires: ${req} of 6th Verse`;
  boostBtn.disabled = game.verses[5].amount < req;
  document.getElementById('boost-mult').textContent = (1.06 + game.boostCount * 0.02).toFixed(2);
}

// ──────────────────────────────────────────────
// Update Display
// ──────────────────────────────────────────────
function updateDisplay() {
  document.getElementById('chills').textContent = game.chills.toFixed(1);
  document.getElementById('player-name-top').textContent = game.name || 'Player';
  document.getElementById('profile-name').textContent = game.name || 'Player';
  document.getElementById('profile-phone').textContent = game.phone || '';
  document.getElementById('avatar').textContent = (game.name || 'P')[0].toUpperCase();
  renderVerses();
}

// ──────────────────────────────────────────────
// Init & Events
// ──────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
  // Login
  document.getElementById('login-form').onsubmit = e => {
    e.preventDefault();
    game.name = document.getElementById('player-name').value.trim() || 'Player';
    game.phone = document.getElementById('player-phone').value.trim();

    document.getElementById('login').classList.remove('active');
    document.getElementById('loading').classList.add('active');

    setTimeout(() => {
      document.getElementById('logged-as').hidden = false;
      document.getElementById('logged-as').querySelector('strong').textContent = game.name;

      setTimeout(() => {
        document.getElementById('loading').classList.remove('active');
        document.getElementById('main').classList.add('active');

        loadGame();

        // Offline gain
        const offlineGain = calculateOfflineGain();
        if (offlineGain > 0) {
          document.getElementById('offline-gain').textContent = `You gained ${offlineGain.toFixed(1)} chills while away!`;
          document.getElementById('offline-modal').showModal();
        }

        updateDisplay();

        // Start tick
        setInterval(tick, 100);
      }, 3000);
    }, 2000);
  };

  // Buy verse clicks
  document.getElementById('verses-list').onclick = e => {
    if (e.target.matches('.btn-buy[data-index]')) {
      buyVerse(parseInt(e.target.dataset.index));
    }
  };

  // Boost
  document.getElementById('boost-btn').onclick = verseBoost;

  // Sticky Earn
  document.getElementById('sticky-earn').onclick = () => {
    document.getElementById('convert-modal').showModal();
  };

  // Logout / Reset
  document.getElementById('logout').onclick = () => location.reload();
  document.getElementById('reset').onclick = () => {
    if (confirm('Reset everything?')) {
      localStorage.removeItem('idleVerses');
      location.reload();
    }
  };

  // Particles (same)
  const canvas = document.getElementById('particles');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const ctx = canvas.getContext('2d');
  const particles = Array.from({length: 60}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    vx: (Math.random() - 0.5) * 0.4,
    vy: (Math.random() - 0.5) * 0.4,
    r: Math.random() * 1.5 + 0.5
  }));

  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
      p.x += p.vx; p.y += p.vy;
      if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
      if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(6,182,212,0.5)';
      ctx.fill();
    });
    requestAnimationFrame(animate);
  }
  animate();
});
</script>
</body>
</html>
